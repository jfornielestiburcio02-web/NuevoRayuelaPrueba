<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>TiPortal - Mini Red Social</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
    body { font-family: Arial; padding: 20px; }
    button { margin: 5px; padding: 5px 10px; }
    #videos div { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
    textarea { width: 100%; height: 50px; }
</style>
</head>
<body>
<h1>TiPortal</h1>
<button id="loginBtn">Iniciar sesión con Google</button>
<div id="userInfo"></div>

<h2>Publicar Video</h2>
<input type="text" id="videoUrl" placeholder="URL de YouTube">
<button onclick="publicarVideo()">Publicar</button>

<h2>Videos</h2>
<div id="videos"></div>

<script>
// --- CONFIGURA FIREBASE AQUÍ ---
const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    projectId: "TU_PROJECT_ID",
    storageBucket: "TU_STORAGE_BUCKET",
    messagingSenderId: "TU_MESSAGING_SENDER_ID",
    appId: "TU_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// --- LOGIN CON GOOGLE ---
const loginBtn = document.getElementById('loginBtn');
loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
        .then(res => {
            document.getElementById('userInfo').textContent = `Hola, ${res.user.displayName}`;
            loginBtn.style.display = 'none';
        })
        .catch(console.error);
};

// --- PUBLICAR VIDEO ---
function publicarVideo() {
    const url = document.getElementById('videoUrl').value;
    if(!auth.currentUser) { alert("Inicia sesión primero"); return; }
    if(!url) { alert("Pon una URL"); return; }

    db.collection('videos').add({
        url,
        autor: auth.currentUser.displayName,
        comentarios: [],
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        document.getElementById('videoUrl').value = '';
        cargarVideos();
    });
}

// --- CARGAR VIDEOS ---
function cargarVideos() {
    const container = document.getElementById('videos');
    container.innerHTML = '';
    db.collection('videos').orderBy('timestamp','desc').get().then(snapshot => {
        snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement('div');

            div.innerHTML = `
                <p><strong>${data.autor}</strong></p>
                <iframe width="320" height="180" src="${data.url.replace("watch?v=", "embed/")}" frameborder="0" allowfullscreen></iframe>
                <div>
                    <h4>Comentarios:</h4>
                    <div id="comentarios-${doc.id}">
                        ${data.comentarios.map(c => `<p><strong>${c.autor}:</strong> ${c.text}</p>`).join('')}
                    </div>
                    <textarea id="txt-${doc.id}" placeholder="Escribe un comentario..."></textarea>
                    <button onclick="comentar('${doc.id}')">Comentar</button>
                </div>
            `;
            container.appendChild(div);
        });
    });
}

// --- AGREGAR COMENTARIO ---
function comentar(videoId) {
    const texto = document.getElementById(`txt-${videoId}`).value;
    if(!auth.currentUser) { alert("Inicia sesión primero"); return; }
    if(!texto) return;

    const ref = db.collection('videos').doc(videoId);
    ref.update({
        comentarios: firebase.firestore.FieldValue.arrayUnion({
            autor: auth.currentUser.displayName,
            text: texto
        })
    }).then(() => {
        document.getElementById(`txt-${videoId}`).value = '';
        cargarVideos();
    });
}

// Cargar videos al inicio
cargarVideos();
</script>
</body>
</html>
